# MJIReader [![Build Status](https://travis-ci.org/ksgwr/MJIReader.svg?branch=master)](https://travis-ci.org/ksgwr/MJIReader)
## 概要
IPA 独立行政法人情報処理推進機構から提供される[MJ文字情報一覧表](https://mojikiban.ipa.go.jp/1311.html)、[MJ縮退マップ](https://mojikiban.ipa.go.jp/4144.html)を使用し異体字・外字・正字を扱うためのクラスを提供します。読みや画数、部首などの情報も取れるため形態素解析できなかった単語に関して文字素性を取得することにも利用が可能かもしれません。

## 成果物

MJ文字情報と縮退マップを組み合わせ正規化すべき文字の一覧を[ExtractNormalizerMap](src/main/java/jp/ksgwr/mji/cli/ExtractNormalizerMap.java)で作成しました。
詳しくはMJ縮退マップのアルゴリズムを参照する必要がありますが、JIS包摂・UCS統合規則・戸籍法・法務省別表四の一を利用して代替文字を定めています。
この例のように実際に利用する時は最適なデータ形式に変換してから利用するのが効率的にも良いでしょう。

[MappingData(約230KB)](output/normalizerMap.tsv)

```
髙	高	MJ028902
齌	齎	MJ030064
齍	斉	MJ030065
齍	斉	MJ030066
齐	斉	MJ030071
```

　上記は見慣れない漢字も含まれており、JIS第二水準までの漢字からより簡単な変換規則のみを[ExtractMinimumCommonNormalizerMap](src/main/java/jp/ksgwr/mji/cli/ExtractMinimumCommonNormalizerMap.java)で作成しました。実際に利用するのはこのぐらいのデータから扱うと良いと思います。「龍」⇒「竜」の正規化ルールからも分かるように表示用の正規化として使うことは考えていません。  
　また、現在の日本で定義されている限りでは渡邉・渡辺、斉藤・齊藤は同じ表記として扱われる可能性がありますが、渡辺・渡部、斉藤・斎藤は別々の表記として扱われます。理由としてはこれらは文字の語源が違い、使われる単語によっては別の意味になってしまう可能性があるからです。このような文字は単語単位で正規化すべきです。

[MappingMiniData(約10KB)](output/normalizerMapMin.tsv)

```
𡿳	鼠	MJ030003
齊	斉	MJ030059
齋	斎	MJ030060
齒	歯	MJ030072
齡	齢	MJ030089
龍	竜	MJ030124
```

## データを取得するクラスサンプル

```java
MJTable mjTable = MJIReader.createInstance();
```

## License

[クリエイティブ・コモンズ 表示 – 継承 2.1 日本 ライセンス](http://creativecommons.org/licenses/by-sa/2.1/jp/)によって提供しています。

## 備考

mojikiban.ipa.go.jp.mji以下のパッケージは下記コマンドで自動生成しています。

```
$ xjc src/main/resources/mji.00502/mji00502.xsd -encoding utf8
```

登録されている漢字は[文字情報基盤データベース](https://mojikiban.ipa.go.jp/search/home)でも調べることができます。

## Tips
### 字体（グリフ）と字形、書体、文字集合の違い

　字体（グリフ）とは文字の骨組みを扱う抽象的な概念です。例えば「髙」「高」は旧字体・新字体の違いであると言えます。対して字形は個々の文字の見た目，形状を具体的に示す概念です。同じ文字を表す場合でも書き方によってわずかに異なるものは字形の違いであると言えます。書体は文字に体系的に施された一定の特徴や様式のことです。明朝体やゴシック体などフォントによる違いは書体の違いです。  
　文字集合とはコンピュータでこれら文字を扱うための統一的な規格です。コンピュータで扱うためには有限空間でより効率的に扱う必要があり、UCS(Universal Coded Character Set)という国際規格が定義されています。UCS-4は31bitで表現されint型で表現され、実際の値を文字符号(コードポイント)と呼びます。文字集合は有限であるため基本的に字形の違いは扱わず字体までを扱います。  
　ちなみにこの文書はUTF-8で記述しているため、扱える文字はこのUCS-4で扱える文字のみです。IPAで扱っているMJ文字情報は漢字に限定し、字形の違いも含めた文字集合を定義しています。

** 参考文献 **
* 漢字小委員会 H27.1.16『[常用漢字表における「字体・書体・字形」等の考え方について](http://www.bunka.go.jp/seisaku/bunkashingikai/kokugo/shoiinkai/iinkai_14/pdf/shiryo_3.pdf)』

### IVD/IVS、統合・包摂・異体字

IVS(Ideographic Variation Sequence/Selector)は、文字符号としては同一視される漢字の、細かな字形の差異を特別に使い分けるための仕組みで2008年に規定されています。UCSでは複数の字形に対して一つの共通な符号を与える場合があり、これをJISでは包摂と呼び、UCSでは統合と呼んでいます。例えば、東京都葛飾区と奈良県葛城市では異なる「葛」の字形を用いますがこの文字コードで表現ができません。これを区別するために字形の違いをIVDというデータベースに登録しフォントにより字形の違いを表現する仕組みがあります。「葛」の例は字形の違いというには例えば画数も違い大きすぎるほど異なっています。包摂とは字形の違いを吸収する概念ではありますがJISの包摂(JIS X 0213 包摂基準)もこのような例は存在します。このような字義が同じで字体を包摂しないものを異体字と呼びます。

** 参考文献 **
* IPA [IVD/IVSとは](https://mojikiban.ipa.go.jp/1292.html)

### 包摂の難しさ

字形の違いで長短の異なりを吸収する包摂基準があったりします。例えば「吉」「𠮷」は包摂することがありますが「土（ツチ）」「士（サムライ）」は字義が異なるので包摂されません。一方で文字の原点が同じだった場合に「卤（セイ）」「西（セイ）」の様な漢字も字義が同じとなり包摂されることもあります。このように包摂できるかは見た目だけでなく字義についての判断も必要になりコンピュータに登録する際に誤写で登録された典拠不明の文字を幽霊文字と呼んだりします。この様な異体字も誤写によって生まれた文字も多く、文字の意味は時代によっても変化する可能性があり理想的な包摂基準を定義することはとても難しいと言えます。

### CJK統合漢字の失敗

　Javaの標準NormalizerにはNFKCなどのUnicode正規化機能が提供されています。Unicode正規化は正準等価・互換等価に基づいて正規化され、「(株)」「㈱」の正規化や半角・全角の正規化など便利な正規化が提供されていますが、一つ落とし穴があります。それがCJK統合漢字です。
CJK統合漢字は中国語、日本語、朝鮮語で使われている漢字をひとまとめにした漢字の符号表です。例えば「神」「神」の様な文字が統合されます。しかし、日本の「机」（つくえ）と中国の「机」（機の簡化字）の様な字義が異なる漢字まで統合されてしまいます。これは「土（ツチ）」「士（サムライ）」が統合されることと同じ意味を持ちます。そして、「齊」「斉」の様な漢字は統合されません。CJK統合漢字は字形（見た目）での統合が中心であったため、このような中途半端な統合が生まれてしまいました。  
　文字と文化は関連性を持ち、国を跨いだ安易な統合はするべきではありません。日本語に絞って扱ったのがJISの包摂基準でありますが、これも字形での包摂が基本であったため異体字まで扱われていません。異体字を扱う基準としては「戸籍統一文字情報」などが公開されており今回の正規化にはこれらの情報を合体させ利用しています。
